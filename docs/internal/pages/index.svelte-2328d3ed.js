var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,o=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&l(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&l(e,a,t[a]);return e},i=(e,s)=>t(e,a(s));import{J as c,K as u,C as h,S as d,i as f,s as g,e as m,t as p,k as v,c as y,a as b,g as w,d as L,n as x,b as $,L as D,f as I,H as E,M as T,N as k,O as S,l as z,I as N,P,Q as q,R as A,T as O,h as H,U,V as R,x as M,r as B,u as C,w as Y,W as V,j,m as J,o as F,v as X,X as W,Y as _,Z as Q,_ as K,A as Z,$ as G,a0 as ee}from"../chunks/vendor-a93b09cf.js";const te=new c("https://bqljggidsuurzwjgspix.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMzc2MTI0MywiZXhwIjoxOTQ5MzM3MjQzfQ.lQzW2bbkwkN4IPf0QqJVHkTh_YJdd9mATglBUktRBpA",{});function ae(e,t){document.cookie=`${e}=${JSON.stringify(t)}`}async function se(e,t){const a=JSON.stringify(t),{data:s,error:r}=await te.storage.from("images").upload(`${e.id}/frameData.txt`,a,{upsert:!0});r&&console.log(r)}async function re(e){const t=new Blob,{data:a,error:s}=await te.storage.from("images").upload(`${e.id}/_blank.txt`,t,{upsert:!0});console.log(a),console.log(s)}let ne;function le(e,t,a){e.setItem(t,JSON.stringify(a))}function oe(e,t,a){let s=null;try{if(s=JSON.parse(e.getItem(t)),""==s)throw new Error("Smile empty soul");return s}catch(r){return console.warn(r),a}}function ie(e){null==e.userData?le(ne,"frameList",e.frameList):se(e.userData,e.frameList),console.log("saved uwu ✨")}ne=window.localStorage;let ce=0;const ue=[{currentTrans:"",currentState:"",framesSnapshot:[]}],he=h({currentTrans:"",currentState:"",framesSnapshot:[]});function de(){he.update((()=>(ce+=1,ce===ue.length&&(ce=ue.length-1),ue[ce])))}function fe(e){ce+=1;const t=ue,a=i(o({},t[ce-1]),{framesSnapshot:e});t.push(a),he.update((()=>a))}function ge(e,t,a){return{currentTrans:"",currentState:e[t],framesSnapshot:a}}const me=new c("https://bqljggidsuurzwjgspix.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMzc2MTI0MywiZXhwIjoxOTQ5MzM3MjQzfQ.lQzW2bbkwkN4IPf0QqJVHkTh_YJdd9mATglBUktRBpA",{});let pe,ve,ye;const be=h({loggedIn:pe,userData:ve,sessionData:ye}),we=async()=>{const e=function(e){const t=document.cookie.split(";").find((t=>t.includes(`${e}=`)));return t?JSON.parse(t.split("=")[1]):null}("refreshToken"),{user:t,session:a,error:s}=await me.auth.signIn({refreshToken:e});return!s&&(ae("refreshToken",a.refresh_token),await re(t),be.update((()=>({userData:t,sessionData:a,loggedIn:!0}))),ve=t,pe=!0,ye=a,!0)},Le=h({notifications:[]}),xe=[];let $e="",De=!1;function Ie(e){Le.update((()=>(xe.push(e.notification),{notifications:xe})))}Le.subscribe((e=>{console.log(e),e.notifications.length>0&&0==De&&(De=!0,setTimeout((()=>{$e=e.notifications[0],e.notifications.shift(),De=!1,Le.update((()=>({notifications:e.notifications})))}),1e3))}));const Ee={width:20,height:20,x:0,y:0};function Te(e){return console.log(e),new Promise(((t,a)=>{e.url||a();const s=e.frameList.length;let r={url:e.url,width:400,height:400,x:100,y:100,style:"",id:s,topLeftHandle:Ee,topRightHandle:i(o({},Ee),{x:380}),bottomRightHandle:i(o({},Ee),{x:380,y:380}),bottomLeftHandle:i(o({},Ee),{y:380}),top:!0,active:!0,aspect:0,offset:[0,0]};const n=new Image;n.src=r.url,n.onload=()=>{console.log(n.naturalHeight,n.naturalWidth),r.height=n.naturalHeight,r.width=n.naturalWidth,r.aspect=r.width/r.height,r=Ne(r),r.style=ke(r),Oe(r),t(r)}}))}function ke(e,t){let a,s="",r=e.width,n=e.height;if(t)switch(t){case"tleft":r=e.topLeftHandle.width,n=e.topLeftHandle.height,a=` top: ${e.topLeftHandle.y}px; left: ${e.topLeftHandle.x}px;`;break;case"tright":r=e.topRightHandle.width,n=e.topRightHandle.height,a=` top: ${e.topRightHandle.y}px; left: ${e.topRightHandle.x}px;`;break;case"bleft":r=e.bottomLeftHandle.width,n=e.bottomLeftHandle.height,a=` top: ${e.bottomLeftHandle.y}px; left: ${e.bottomLeftHandle.x}px;`;break;case"bright":r=e.bottomRightHandle.width,n=e.bottomRightHandle.height,a=` top: ${e.bottomRightHandle.y}px; left: ${e.bottomRightHandle.x}px;`;break;default:return}return s=`width: ${r}px; height: ${n}px; position: fixed;`,t||(s+=` background-image: url('${e.url}'); top: ${e.y}px; left: ${e.x}px;`),t&&(s+=a),s}function Se(e){return e.map((e=>i(o({},e),{active:!1})))}function ze(e){return JSON.parse(JSON.stringify(e))}function Ne(e){const t=e.width/e.height;let a=window.visualViewport.width/2,s=window.visualViewport.width/2;return e.width>e.height?s=a/t:a=s*t,console.log(a,s,t),i(o({},e),{width:a,height:s})}function Pe(e){switch(e.frameList.filter((e=>1==e.active)),e.event.key){case"a":e.event.ctrlKey&&(e.frameList=e.frameList.map((e=>i(o({},e),{active:!0}))),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList}),Ie({notification:"Select All"}));break;case"A":e.event.ctrlKey&&(e.frameList=Se(e.frameList),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList}),Ie({notification:"Select All"}));break;case"y":e.event.ctrlKey&&(de(),Ie({notification:"Redo"}));break;case"z":e.event.ctrlKey&&(t=e.userData,console.log("reversing history uwu ✨"),he.update((()=>0==ce?(ie({userData:t,frameList:[]}),null):ce>0?(ce-=1,console.log(ue[ce].framesSnapshot),ie({userData:t,frameList:ue[ce].framesSnapshot}),ue[ce]):void 0)),Ie({notification:"Undo"}));break;case"Z":e.event.ctrlKey&&(console.log("yay~"),de(),Ie({notification:"Undo"}));break;case"Escape":e.frameList=Se(e.frameList),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList}),Ie({notification:"Select None"});break;case"Delete":case"Backspace":e.frameList=e.frameList.filter((e=>0==e.active)),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList}),Ie({notification:"Cleared Image"});break;case"ArrowLeft":e.frameList=qe(e.frameList,"left"),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList});break;case"ArrowRight":e.frameList=qe(e.frameList,"right"),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList});break;case"ArrowUp":e.frameList=qe(e.frameList,"up"),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList});break;case"ArrowDown":e.frameList=qe(e.frameList,"down"),fe(e.frameList),ie({userData:e.userData,frameList:e.frameList})}var t;if(e.frameList)return e.frameList}function qe(e,t){const a=40,s=function(e){return e.filter((e=>1==e.top))[0]}(e);switch(t){case"left":e[s.id].x=e[s.id].x-a-e[s.id].x%a,console.log(e[s.id].x);break;case"right":e[s.id].x=e[s.id].x+a-e[s.id].x%a;break;case"up":e[s.id].y=e[s.id].y-a-e[s.id].y%a;break;case"down":e[s.id].y=e[s.id].y+a-e[s.id].y%a}return Oe(s),e[s.id].style=ke(s),e}function Ae(e,t,a){if("mouse"===(null==e?void 0:e.pointerType)){const a={x:0,y:0};a.x=e.movementX,a.y=e.movementY,t.x+=a.x,t.y+=a.y}else t.x=e.changedTouches[0].clientX-a[0],t.y=e.changedTouches[0].clientY-a[1],console.log(a[0]);return(t=Oe(t)).style=ke(t),t}function Oe(e){return e.topLeftHandle.x=e.x,e.topLeftHandle.y=e.y,e.topRightHandle.x=e.x+e.width-e.topRightHandle.width,e.topRightHandle.y=e.y,e.bottomLeftHandle.x=e.x,e.bottomLeftHandle.y=e.y+e.height-e.bottomLeftHandle.height,e.bottomRightHandle.x=e.x+e.width-e.bottomRightHandle.width,e.bottomRightHandle.y=e.y+e.height-e.bottomRightHandle.height,e}async function He(e){var t,a,s,r;const n=null==(a=null==(t=e.event)?void 0:t.clipboardData)?void 0:a.items[0].getAsFile();let l=null==(r=null==(s=e.event)?void 0:s.clipboardData)?void 0:r.getData("text");if(console.log(e.loggedIn),n)if(console.log("image pasted"),0==e.loggedIn||null==e.loggedIn){await async function(e){const t=new FileReader;let a;t.addEventListener("loadend",(s=>{a=t.result;let r=oe(e.appStorage,"localImages",[]);if(null!=r||(r=[]),0!=r.length||null!=r){const t=r.filter((t=>t.id==e.frameList.length));(t.length<1||null==t)&&(r.push({imageFile:e.imageFile,id:e.frameList.length,type:e.imageFile.type,text:a}),le(e.appStorage,"localImages",r))}0==r.length&&(r.push({imageFile:e.imageFile,id:e.frameList.length,type:e.imageFile.type,text:a}),le(e.appStorage,"localImages",r))})),t.readAsDataURL(e.imageFile)}({imageFile:n,frameList:e.frameList,appStorage:e.appStorage});const t=await function(e){let t=[];t=oe(e.appStorage,"localImages",[]),null==t&&(t=[]);const a=t.filter((t=>t.id==e.frameList.length))[0];return new Promise((e=>{e(a)}))}({appStorage:e.appStorage,frameList:e.frameList});l=t.text,console.log(l)}else{const{error:t,imageUrl:a}=await async function(e){const t=u(),{data:a,error:s}=await te.storage.from("images").upload(`${e.userData.id}/${t}`,e.imageFile,{upsert:!0});if(s)return{error:s,imageUrl:null};{console.log(a.Key);const{error:s,publicURL:r}=await te.storage.from("images").getPublicUrl(`${e.userData.id}/${t}`);return s?{error:s,imageUrl:null}:(console.log(r),{error:null,imageUrl:r})}}({userData:e.userData,imageFile:n});t?console.log(t):(l=a,console.log(l))}let o=await Te({userData:e.userData,url:l,frameList:e.frameList});o.x=50,o.y=100,o.style=`position:fixed; left:${o.x}px; top:${o.y}px;`;const i=new Image;i.src=l,console.log(l),i.onload=()=>{console.log(i.naturalHeight,i.naturalWidth),o.height=i.naturalHeight,o.width=i.naturalWidth,o=Ne(o),o.style=ke(o),Oe(o),l&&(e.frameList=[...e.frameList,o]),e.frameList=Re(o.id,e.frameList),console.log(e.frameList.filter((e=>e.id==o.id))),fe(e.frameList)}}function Ue(e){return e.filter((e=>null!==e||void 0!==e))}function Re(e,t){return t.map((t=>t=t.id==e?i(o({},t),{top:!0,active:!0}):i(o({},t),{top:!1,active:!1})))}function Me(e){let t,a,s,r,n,l,o,i,c,u,h,d,f,g,z,N,P,q,A,O;return{c(){t=m("div"),a=m("button"),s=p("Delete"),l=v(),o=m("div"),u=v(),h=m("div"),g=v(),z=m("div"),N=p("Resize"),this.h()},l(e){t=y(e,"DIV",{class:!0,draggable:!0,style:!0});var r=b(t);a=y(r,"BUTTON",{class:!0});var n=b(a);s=w(n,"Delete"),n.forEach(L),r.forEach(L),l=x(e),o=y(e,"DIV",{class:!0,draggable:!0,style:!0}),b(o).forEach(L),u=x(e),h=y(e,"DIV",{class:!0,draggable:!0,style:!0}),b(h).forEach(L),g=x(e),z=y(e,"DIV",{class:!0,style:!0});var i=b(z);N=w(i,"Resize"),i.forEach(L),this.h()},h(){$(a,"class","svelte-qzwrll"),$(t,"class",r=D(`${e[2]} handle handle-tleft`)+" svelte-qzwrll"),$(t,"draggable","true"),$(t,"style",n=ke(e[0],"tleft")),$(o,"class",i=D(`${e[2]} handle handle-tright`)+" svelte-qzwrll"),$(o,"draggable","true"),$(o,"style",c=ke(e[0],"tright")),$(h,"class",d=D(`${e[2]} handle handle-bleft`)+" svelte-qzwrll"),$(h,"draggable","true"),$(h,"style",f=ke(e[0],"bleft")),$(z,"class",P=D(`${e[2]} handle handle-bright`)+" svelte-qzwrll"),$(z,"style",q=ke(e[0],"bright"))},m(r,n){I(r,t,n),E(t,a),E(a,s),I(r,l,n),I(r,o,n),I(r,u,n),I(r,h,n),I(r,g,n),I(r,z,n),E(z,N),A||(O=[T(a,"click",e[12]),T(t,"dragstart",e[13]),T(o,"dragstart",e[14]),T(h,"dragstart",e[15]),T(h,"dragover",k(e[16])),T(z,"pointerdown",e[17])],A=!0)},p(e,a){4&a&&r!==(r=D(`${e[2]} handle handle-tleft`)+" svelte-qzwrll")&&$(t,"class",r),1&a&&n!==(n=ke(e[0],"tleft"))&&$(t,"style",n),4&a&&i!==(i=D(`${e[2]} handle handle-tright`)+" svelte-qzwrll")&&$(o,"class",i),1&a&&c!==(c=ke(e[0],"tright"))&&$(o,"style",c),4&a&&d!==(d=D(`${e[2]} handle handle-bleft`)+" svelte-qzwrll")&&$(h,"class",d),1&a&&f!==(f=ke(e[0],"bleft"))&&$(h,"style",f),4&a&&P!==(P=D(`${e[2]} handle handle-bright`)+" svelte-qzwrll")&&$(z,"class",P),1&a&&q!==(q=ke(e[0],"bright"))&&$(z,"style",q)},d(e){e&&L(t),e&&L(l),e&&L(o),e&&L(u),e&&L(h),e&&L(g),e&&L(z),A=!1,S(O)}}}function Be(e){let t,a,s,r,n,l,o,i=e[0].active&&Me(e);return{c(){t=m("div"),r=v(),i&&i.c(),n=z(),this.h()},l(e){t=y(e,"DIV",{class:!0,draggable:!0,style:!0}),b(t).forEach(L),r=x(e),i&&i.l(e),n=z(),this.h()},h(){var r;$(t,"class",a=D(`frame ${e[2]}`)+" svelte-qzwrll"),$(t,"draggable","true"),$(t,"style",s=null==(r=e[0])?void 0:r.style)},m(a,s){I(a,t,s),I(a,r,s),i&&i.m(a,s),I(a,n,s),l||(o=[T(t,"dragover",e[9]),T(t,"dragstart",e[10]),T(t,"dragend",e[11])],l=!0)},p(e,[r]){var l;4&r&&a!==(a=D(`frame ${e[2]}`)+" svelte-qzwrll")&&$(t,"class",a),1&r&&s!==(s=null==(l=e[0])?void 0:l.style)&&$(t,"style",s),e[0].active?i?i.p(e,r):(i=Me(e),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},i:N,o:N,d(e){e&&L(t),e&&L(r),i&&i.d(e),e&&L(n),l=!1,S(o)}}}function Ce(e,t,a){let{frame:s}=t,{frameList:r}=t,{addedClass:n=""}=t,l={x:0,y:0},o=[0,0],i=[0,0],c=` background-image: url('${null==s?void 0:s.url}');`;null==s||s.width,null==s||s.height,s.style=(null==s?void 0:s.style)+c;const u=e=>(e.dataTransfer.setData("frame id",s.id),e.dataTransfer.dropEffect="move",l.x=e.clientX,l.y=e.clientY,i=[s.x,s.y],a(3,o=[l.x-i[0],l.y-i[1]]),o),h=e=>(e.dataTransfer.getData("frame id"),l.x=e.pageX,l.y=e.pageY,i=[s.x,s.y],a(0,s.x=e.clientX-o[0],s),a(0,s.y=e.clientY-o[1],s),a(0,s.style=`width: ${s.width}px; height: ${s.height}px; position: fixed; left: ${s.x}px; top: ${s.y}px;`+c,s),a(0,s=Oe(s)),!1),d=(e,t)=>(e.dataTransfer.setData("frame id",s.id),l.x=e.clientX,l.y=e.clientY,i=[s.x,s.y],a(3,o=[l.x-s.x,l.y-s.y]),o),f=(e,t)=>{switch(e=e||window.event,console.log(e),l.x=e.movementX,l.y=e.movementY,t){case"bright":a(0,s.width=s.width+l.x,s),a(0,s.height=s.height+l.y,s),console.log(s.width,s.height);break;default:return}a(0,s=Oe(s))},g=P();function m(e,t,a){console.log("send"),g("message",{frame:e,event:t,edge:a})}return e.$$set=e=>{"frame"in e&&a(0,s=e.frame),"frameList"in e&&a(1,r=e.frameList),"addedClass"in e&&a(2,n=e.addedClass)},[s,r,n,o,u,h,d,f,m,e=>h(e),e=>{a(3,o=u(e))},e=>ie(r),e=>{a(1,r=r.filter((e=>0==e.top)))},e=>a(3,o=d(e)),e=>a(3,o=d(e)),e=>a(3,o=d(e)),e=>f(e,"bleft"),e=>{m(s,e,"bright")}]}class Ye extends d{constructor(e){super(),f(this,e,Ce,Be,g,{frame:0,frameList:1,addedClass:2})}}function Ve(e){let t,a,s,r,n,l,o,i,c,u,h,d;return{c(){t=m("section"),a=m("input"),s=v(),r=m("div"),n=m("button"),l=m("span"),o=p("add"),i=v(),c=m("span"),u=p("Add Image"),this.h()},l(e){t=y(e,"SECTION",{id:!0,class:!0});var h=b(t);a=y(h,"INPUT",{id:!0,placeholder:!0,"aria-placeholder":!0,class:!0}),s=x(h),r=y(h,"DIV",{id:!0,class:!0});var d=b(r);n=y(d,"BUTTON",{class:!0});var f=b(n);l=y(f,"SPAN",{class:!0});var g=b(l);o=w(g,"add"),g.forEach(L),i=x(f),c=y(f,"SPAN",{class:!0});var m=b(c);u=w(m,"Add Image"),m.forEach(L),f.forEach(L),d.forEach(L),h.forEach(L),this.h()},h(){$(a,"id","textInput"),$(a,"placeholder","Enter image URL"),$(a,"aria-placeholder","Enter image URL"),$(a,"class","svelte-b8i4gs"),$(l,"class","material-icons"),$(c,"class","button-text svelte-b8i4gs"),$(n,"class","svelte-b8i4gs"),$(r,"id","submit"),$(r,"class","svelte-b8i4gs"),$(t,"id","inputArea"),$(t,"class","svelte-b8i4gs")},m(f,g){I(f,t,g),E(t,a),q(a,e[0]),E(t,s),E(t,r),E(r,n),E(n,l),E(l,o),E(n,i),E(n,c),E(c,u),h||(d=[T(a,"input",e[5]),T(a,"keypress",(function(){A(e[1].bind(e[0]))&&e[1].bind(e[0]).apply(this,arguments)})),T(n,"mousedown",e[6]),T(t,"click",k(e[4]))],h=!0)},p(t,[s]){e=t,1&s&&a.value!==e[0]&&q(a,e[0])},i:N,o:N,d(e){e&&L(t),h=!1,S(d)}}}function je(e,t,a){var s=this&&this.__awaiter||function(e,t,a,s){return new(a||(a=Promise))((function(r,n){function l(e){try{i(s.next(e))}catch(t){n(t)}}function o(e){try{i(s.throw(e))}catch(t){n(t)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}i((s=s.apply(e,t||[])).next())}))};let{frameList:r}=t,{userData:n}=t,l="";const o=e=>s(void 0,void 0,void 0,(function*(){if("enter"==e.key.toLowerCase()){let e=yield Te({userData:n,url:l,frameList:r});a(2,r=[...r,e]),a(2,r=Re(e.id,r)),fe(r),a(0,l="")}}));return e.$$set=e=>{"frameList"in e&&a(2,r=e.frameList),"userData"in e&&a(3,n=e.userData)},[l,o,r,n,function(t){O.call(this,e,t)},function(){l=this.value,a(0,l)},e=>{e.preventDefault(),o({key:"enter"})}]}class Je extends d{constructor(e){super(),f(this,e,je,Ve,g,{frameList:2,userData:3})}}function Fe(e){let t,a,s,r,n,l,o,i,c,u,h,d;function f(e,t){return e[11]?We:Xe}let g=f(e),p=g(e),w=e[7]&&Ze(e),D=e[8]&&Ge(),k=e[9]&&et(),S=e[10]&&tt();return{c(){t=m("div"),s=v(),r=m("div"),p.c(),n=v(),w&&w.c(),l=v(),D&&D.c(),o=v(),k&&k.c(),i=v(),S&&S.c(),this.h()},l(e){t=y(e,"DIV",{class:!0}),b(t).forEach(L),s=x(e),r=y(e,"DIV",{class:!0,id:!0});var a=b(r);p.l(a),n=x(a),w&&w.l(a),l=x(a),D&&D.l(a),o=x(a),k&&k.l(a),i=x(a),S&&S.l(a),a.forEach(L),this.h()},h(){$(t,"class","modal svelte-1vgqnhz"),$(r,"class","auth-dropdown svelte-1vgqnhz"),$(r,"id","auth-dropdown")},m(a,c){I(a,t,c),I(a,s,c),I(a,r,c),p.m(r,null),E(r,n),w&&w.m(r,null),E(r,l),D&&D.m(r,null),E(r,o),k&&k.m(r,null),E(r,i),S&&S.m(r,null),u=!0,h||(d=T(t,"click",e[14]),h=!0)},p(e,t){g===(g=f(e))&&p?p.p(e,t):(p.d(1),p=g(e),p&&(p.c(),p.m(r,n))),e[7]?w?w.p(e,t):(w=Ze(e),w.c(),w.m(r,l)):w&&(w.d(1),w=null),e[8]?D||(D=Ge(),D.c(),D.m(r,o)):D&&(D.d(1),D=null),e[9]?k||(k=et(),k.c(),k.m(r,i)):k&&(k.d(1),k=null),e[10]?S||(S=tt(),S.c(),S.m(r,null)):S&&(S.d(1),S=null)},i(e){u||(e&&U((()=>{a||(a=R(t,V,{duration:100},!0)),a.run(1)})),e&&U((()=>{c||(c=R(r,V,{duration:100},!0)),c.run(1)})),u=!0)},o(e){e&&(a||(a=R(t,V,{duration:100},!1)),a.run(0)),e&&(c||(c=R(r,V,{duration:100},!1)),c.run(0)),u=!1},d(e){e&&L(t),e&&a&&a.end(),e&&L(s),e&&L(r),p.d(),w&&w.d(),D&&D.d(),k&&k.d(),S&&S.d(),e&&c&&c.end(),h=!1,d()}}}function Xe(e){let t,a,s,r=e[4]&&_e(e),n=e[5]&&Qe(e),l=e[6]&&Ke(e);return{c(){r&&r.c(),t=v(),n&&n.c(),a=v(),l&&l.c(),s=z()},l(e){r&&r.l(e),t=x(e),n&&n.l(e),a=x(e),l&&l.l(e),s=z()},m(e,o){r&&r.m(e,o),I(e,t,o),n&&n.m(e,o),I(e,a,o),l&&l.m(e,o),I(e,s,o)},p(e,o){e[4]?r?r.p(e,o):(r=_e(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null),e[5]?n?n.p(e,o):(n=Qe(e),n.c(),n.m(a.parentNode,a)):n&&(n.d(1),n=null),e[6]?l?l.p(e,o):(l=Ke(e),l.c(),l.m(s.parentNode,s)):l&&(l.d(1),l=null)},d(e){r&&r.d(e),e&&L(t),n&&n.d(e),e&&L(a),l&&l.d(e),e&&L(s)}}}function We(e){let t,a,s,r;return{c(){t=m("button"),a=p("Log Out"),this.h()},l(e){t=y(e,"BUTTON",{class:!0});var s=b(t);a=w(s,"Log Out"),s.forEach(L),this.h()},h(){$(t,"class","back-button span-both svelte-1vgqnhz")},m(n,l){I(n,t,l),E(t,a),s||(r=T(t,"click",e[15]),s=!0)},p:N,d(e){e&&L(t),s=!1,r()}}}function _e(e){let t,a,s,r,n,l,o;return{c(){t=m("button"),a=p("Log In"),s=v(),r=m("button"),n=p("Sign Up"),this.h()},l(e){t=y(e,"BUTTON",{class:!0});var l=b(t);a=w(l,"Log In"),l.forEach(L),s=x(e),r=y(e,"BUTTON",{class:!0});var o=b(r);n=w(o,"Sign Up"),o.forEach(L),this.h()},h(){$(t,"class","svelte-1vgqnhz"),$(r,"class","svelte-1vgqnhz")},m(i,c){I(i,t,c),E(t,a),I(i,s,c),I(i,r,c),E(r,n),l||(o=[T(t,"click",e[16]),T(r,"click",e[17])],l=!0)},p:N,d(e){e&&L(t),e&&L(s),e&&L(r),l=!1,S(o)}}}function Qe(e){let t,a,s,r,n,l,o,i,c,u,h,d,f,g,D,k,z,N,P,A,O,H,U,R,M;return{c(){t=m("form"),a=m("label"),s=p("Email"),r=v(),n=m("input"),l=v(),o=m("label"),i=p("Password"),c=v(),u=m("input"),h=v(),d=m("button"),f=p("Submit"),g=v(),D=m("button"),k=p("Back"),z=v(),N=m("p"),P=m("span"),A=p("Don't have an account?"),O=v(),H=m("a"),U=p("Sign up here."),this.h()},l(e){t=y(e,"FORM",{class:!0});var m=b(t);a=y(m,"LABEL",{class:!0,for:!0});var p=b(a);s=w(p,"Email"),p.forEach(L),r=x(m),n=y(m,"INPUT",{class:!0,id:!0,type:!0}),l=x(m),o=y(m,"LABEL",{class:!0,for:!0});var v=b(o);i=w(v,"Password"),v.forEach(L),c=x(m),u=y(m,"INPUT",{class:!0,id:!0,type:!0}),h=x(m),d=y(m,"BUTTON",{class:!0});var $=b(d);f=w($,"Submit"),$.forEach(L),m.forEach(L),g=x(e),D=y(e,"BUTTON",{class:!0});var I=b(D);k=w(I,"Back"),I.forEach(L),z=x(e),N=y(e,"P",{class:!0});var E=b(N);P=y(E,"SPAN",{});var T=b(P);A=w(T,"Don't have an account?"),T.forEach(L),O=x(E),H=y(E,"A",{href:!0});var S=b(H);U=w(S,"Sign up here."),S.forEach(L),E.forEach(L),this.h()},h(){$(a,"class","left svelte-1vgqnhz"),$(a,"for","email"),$(n,"class","right svelte-1vgqnhz"),$(n,"id","email"),$(n,"type","email"),$(o,"class","left svelte-1vgqnhz"),$(o,"for","password"),$(u,"class","right svelte-1vgqnhz"),$(u,"id","password"),$(u,"type","password"),$(d,"class","span-both svelte-1vgqnhz"),d.value="submit",$(t,"class","span-both form svelte-1vgqnhz"),$(D,"class","back-button span-both svelte-1vgqnhz"),$(H,"href","#/"),$(N,"class","span-both svelte-1vgqnhz")},m(m,p){I(m,t,p),E(t,a),E(a,s),E(t,r),E(t,n),q(n,e[2]),E(t,l),E(t,o),E(o,i),E(t,c),E(t,u),q(u,e[1]),E(t,h),E(t,d),E(d,f),I(m,g,p),I(m,D,p),E(D,k),I(m,z,p),I(m,N,p),E(N,P),E(P,A),E(N,O),E(N,H),E(H,U),R||(M=[T(n,"input",e[18]),T(u,"input",e[19]),T(t,"submit",e[20]),T(D,"click",e[21]),T(H,"click",e[22])],R=!0)},p(e,t){4&t&&n.value!==e[2]&&q(n,e[2]),2&t&&u.value!==e[1]&&q(u,e[1])},d(e){e&&L(t),e&&L(g),e&&L(D),e&&L(z),e&&L(N),R=!1,S(M)}}}function Ke(e){let t,a,s,r,n,l,o,i,c,u,h,d,f,g,D,k,z,N,P,A,O,H,U,R,M,B,C,Y,V,j;return{c(){t=m("form"),a=m("label"),s=p("Name"),r=v(),n=m("input"),l=v(),o=m("label"),i=p("Email"),c=v(),u=m("input"),h=v(),d=m("label"),f=p("Password"),g=v(),D=m("input"),k=v(),z=m("button"),N=p("Submit"),P=v(),A=m("button"),O=p("Back"),H=v(),U=m("p"),R=m("span"),M=p("Already have an account?"),B=v(),C=m("a"),Y=p("Log in here."),this.h()},l(e){t=y(e,"FORM",{class:!0});var m=b(t);a=y(m,"LABEL",{class:!0,for:!0});var p=b(a);s=w(p,"Name"),p.forEach(L),r=x(m),n=y(m,"INPUT",{class:!0,id:!0}),l=x(m),o=y(m,"LABEL",{class:!0,for:!0});var v=b(o);i=w(v,"Email"),v.forEach(L),c=x(m),u=y(m,"INPUT",{class:!0,id:!0,type:!0}),h=x(m),d=y(m,"LABEL",{class:!0,for:!0});var $=b(d);f=w($,"Password"),$.forEach(L),g=x(m),D=y(m,"INPUT",{class:!0,id:!0,type:!0}),k=x(m),z=y(m,"BUTTON",{class:!0});var I=b(z);N=w(I,"Submit"),I.forEach(L),m.forEach(L),P=x(e),A=y(e,"BUTTON",{class:!0});var E=b(A);O=w(E,"Back"),E.forEach(L),H=x(e),U=y(e,"P",{class:!0});var T=b(U);R=y(T,"SPAN",{});var S=b(R);M=w(S,"Already have an account?"),S.forEach(L),B=x(T),C=y(T,"A",{href:!0});var q=b(C);Y=w(q,"Log in here."),q.forEach(L),T.forEach(L),this.h()},h(){$(a,"class","left svelte-1vgqnhz"),$(a,"for","name"),$(n,"class","right svelte-1vgqnhz"),$(n,"id","name"),$(o,"class","left svelte-1vgqnhz"),$(o,"for","email"),$(u,"class","right svelte-1vgqnhz"),$(u,"id","email"),$(u,"type","email"),$(d,"class","left svelte-1vgqnhz"),$(d,"for","password"),$(D,"class","right svelte-1vgqnhz"),$(D,"id","password"),$(D,"type","password"),$(z,"class","span-both svelte-1vgqnhz"),$(t,"class","span-both form svelte-1vgqnhz"),$(A,"class","back-button span-both svelte-1vgqnhz"),$(C,"href","#/"),$(U,"class","span-both svelte-1vgqnhz")},m(m,p){I(m,t,p),E(t,a),E(a,s),E(t,r),E(t,n),q(n,e[0]),E(t,l),E(t,o),E(o,i),E(t,c),E(t,u),q(u,e[2]),E(t,h),E(t,d),E(d,f),E(t,g),E(t,D),q(D,e[1]),E(t,k),E(t,z),E(z,N),I(m,P,p),I(m,A,p),E(A,O),I(m,H,p),I(m,U,p),E(U,R),E(R,M),E(U,B),E(U,C),E(C,Y),V||(j=[T(n,"input",e[23]),T(u,"input",e[24]),T(D,"input",e[25]),T(t,"submit",e[26]),T(A,"click",e[27]),T(C,"click",e[28])],V=!0)},p(e,t){1&t&&n.value!==e[0]&&q(n,e[0]),4&t&&u.value!==e[2]&&q(u,e[2]),2&t&&D.value!==e[1]&&q(D,e[1])},d(e){e&&L(t),e&&L(P),e&&L(A),e&&L(H),e&&L(U),V=!1,S(j)}}}function Ze(e){let t,a,s,r=`${e[7].message} :<`;return{c(){t=m("p"),a=m("span"),s=p(r),this.h()},l(e){t=y(e,"P",{class:!0});var n=b(t);a=y(n,"SPAN",{});var l=b(a);s=w(l,r),l.forEach(L),n.forEach(L),this.h()},h(){$(t,"class","span-both error svelte-1vgqnhz")},m(e,r){I(e,t,r),E(t,a),E(a,s)},p(e,t){128&t&&r!==(r=`${e[7].message} :<`)&&H(s,r)},d(e){e&&L(t)}}}function Ge(e){let t,a,s;return{c(){t=m("p"),a=m("span"),s=p("Congrats! Check your email to validate your account :>"),this.h()},l(e){t=y(e,"P",{class:!0});var r=b(t);a=y(r,"SPAN",{});var n=b(a);s=w(n,"Congrats! Check your email to validate your account :>"),n.forEach(L),r.forEach(L),this.h()},h(){$(t,"class","span-both success svelte-1vgqnhz")},m(e,r){I(e,t,r),E(t,a),E(a,s)},d(e){e&&L(t)}}}function et(e){let t,a,s;return{c(){t=m("p"),a=m("span"),s=p("Congrats! You're now logged in :>"),this.h()},l(e){t=y(e,"P",{class:!0});var r=b(t);a=y(r,"SPAN",{});var n=b(a);s=w(n,"Congrats! You're now logged in :>"),n.forEach(L),r.forEach(L),this.h()},h(){$(t,"class","span-both success svelte-1vgqnhz")},m(e,r){I(e,t,r),E(t,a),E(a,s)},d(e){e&&L(t)}}}function tt(e){let t,a,s;return{c(){t=m("p"),a=m("span"),s=p("Congrats! You've now logged out :>"),this.h()},l(e){t=y(e,"P",{class:!0});var r=b(t);a=y(r,"SPAN",{});var n=b(a);s=w(n,"Congrats! You've now logged out :>"),n.forEach(L),r.forEach(L),this.h()},h(){$(t,"class","span-both success svelte-1vgqnhz")},m(e,r){I(e,t,r),E(t,a),E(a,s)},d(e){e&&L(t)}}}function at(e){let t,a,s,r,n,l,o,i=e[3]&&Fe(e);return{c(){t=m("div"),a=m("button"),s=p("Menu"),r=v(),i&&i.c(),n=z(),this.h()},l(e){t=y(e,"DIV",{id:!0,class:!0});var l=b(t);a=y(l,"BUTTON",{class:!0});var o=b(a);s=w(o,"Menu"),o.forEach(L),l.forEach(L),r=x(e),i&&i.l(e),n=z(),this.h()},h(){$(a,"class","svelte-1vgqnhz"),$(t,"id","auth-menu"),$(t,"class","svelte-1vgqnhz")},m(c,u){I(c,t,u),E(t,a),E(a,s),I(c,r,u),i&&i.m(c,u),I(c,n,u),l||(o=T(a,"click",e[13]),l=!0)},p(e,[t]){e[3]?i?(i.p(e,t),8&t&&M(i,1)):(i=Fe(e),i.c(),M(i,1),i.m(n.parentNode,n)):i&&(B(),C(i,1,1,(()=>{i=null})),Y())},i(e){M(i)},o(e){C(i)},d(e){e&&L(t),e&&L(r),i&&i.d(e),e&&L(n),l=!1,o()}}}function st(){let e=document.getElementById("auth-dropdown"),t=0,a=setInterval((function(){t<3?(setTimeout((()=>{e.setAttribute("style","right:5px"),t+=1}),50),e.setAttribute("style","right:0px")):(clearInterval(a),t=0)}),100)}function rt(e,t,a){let s,r,n,l,o,i,c,u,h,d=!1,f=!1,g=!1;be.subscribe((e=>{a(11,h=e.loggedIn)}));const m=()=>{a(8,d=!1),a(9,f=!1),a(7,u=null),a(10,g=!1)};return[s,r,n,l,o,i,c,u,d,f,g,h,m,()=>{a(3,l=!0),a(4,o=!0),a(5,i=!1),a(6,c=!1),m()},()=>{a(3,l=!1),m()},()=>{m(),a(10,g=!0),a(3,l=!0),a(5,i=!1),a(6,c=!1),a(4,o=!1),(async()=>{await me.auth.signOut(),be.update((()=>({loggedIn:!1,userData:null,sessionData:null}))),ae("refreshToken",null)})()},()=>{a(5,i=!0),a(6,c=!1),a(4,o=!1)},()=>{a(6,c=!0),a(5,i=!1),a(4,o=!1)},function(){n=this.value,a(2,n)},function(){r=this.value,a(1,r)},async e=>{e.preventDefault();const t=await(async e=>{const{user:t,session:a,error:s}=await me.auth.signIn({password:e.password,email:e.email});return s||(pe=!0,ve=t,ye=a,ae("refreshToken",a.refresh_token),await re(t),be.update((()=>({loggedIn:!0,userData:ve,sessionData:ye})))),{user:t,session:a,error:s}})({name:s,email:n,password:r});a(7,u=t.error),console.log(t),u&&st(),t.error||a(9,f=!0)},()=>{a(5,i=!1),a(4,o=!0),m()},()=>{a(5,i=!1),a(6,c=!0),m()},function(){s=this.value,a(0,s)},function(){n=this.value,a(2,n)},function(){r=this.value,a(1,r)},async e=>{var t;e.preventDefault(),st();const s=await(async e=>{const{user:t,session:a,error:s}=await me.auth.signUp({password:e.password,email:e.email});if(!s){pe=!0,ye=a;const{user:t,error:s}=await me.auth.update({data:{name:e.name}});s||(ve=t)}return{user:t,session:a,error:s}})({password:r,email:n});console.log(s),(null==(t=null==s?void 0:s.user)?void 0:t.confirmation_sent_at)&&(a(8,d=!0),a(6,c=!1)),(null==s?void 0:s.error)&&(a(7,u=s.error),st())},()=>{a(6,c=!1),a(4,o=!0),m()},()=>{a(5,i=!0),a(6,c=!1),m()}]}class nt extends d{constructor(e){super(),f(this,e,rt,at,g,{})}}function lt(e){let t,a,s;return{c(){t=m("div"),a=m("span"),s=p(e[0]),this.h()},l(r){t=y(r,"DIV",{class:!0});var n=b(t);a=y(n,"SPAN",{class:!0});var l=b(a);s=w(l,e[0]),l.forEach(L),n.forEach(L),this.h()},h(){$(a,"class","svelte-19btlg8"),$(t,"class","svelte-19btlg8")},m(e,r){I(e,t,r),E(t,a),E(a,s)},p(e,[t]){1&t&&H(s,e[0])},i:N,o:N,d(e){e&&L(t)}}}function ot(e,t,a){let s=$e;return Le.subscribe((e=>{var t;a(0,s=null!==(t=e.notifications[0])&&void 0!==t?t:"")})),[s]}class it extends d{constructor(e){super(),f(this,e,ot,lt,g,{})}}function ct(e){let t,a;return{c(){t=m("span"),a=p("Welcome to Polyref. Sign up above to access your ref board from anywhere!")},l(e){t=y(e,"SPAN",{});var s=b(t);a=w(s,"Welcome to Polyref. Sign up above to access your ref board from anywhere!"),s.forEach(L)},m(e,s){I(e,t,s),E(t,a)},p:N,d(e){e&&L(t)}}}function ut(e){let t,a,s;return{c(){t=m("span"),a=p("Welcome to Polyref! Logged in as: "),s=p(e[0])},l(r){t=y(r,"SPAN",{});var n=b(t);a=w(n,"Welcome to Polyref! Logged in as: "),s=w(n,e[0]),n.forEach(L)},m(e,r){I(e,t,r),E(t,a),E(t,s)},p(e,t){1&t&&H(s,e[0])},d(e){e&&L(t)}}}function ht(e){let t,a,s,r,n,l,o,i,c,u,h,d,f;function g(e,t){return e[1]?ut:ct}let D=g(e),T=D(e);return n=new it({}),{c(){t=m("section"),a=m("div"),T.c(),s=v(),r=m("div"),j(n.$$.fragment),l=v(),o=m("div"),i=m("span"),c=p("info"),u=v(),h=m("span"),d=p("What is Polyref?"),this.h()},l(e){t=y(e,"SECTION",{id:!0,class:!0});var f=b(t);a=y(f,"DIV",{id:!0,class:!0});var g=b(a);T.l(g),g.forEach(L),s=x(f),r=y(f,"DIV",{});var m=b(r);J(n.$$.fragment,m),m.forEach(L),l=x(f),o=y(f,"DIV",{id:!0,class:!0});var p=b(o);i=y(p,"SPAN",{class:!0});var v=b(i);c=w(v,"info"),v.forEach(L),u=x(p),h=y(p,"SPAN",{});var $=b(h);d=w($,"What is Polyref?"),$.forEach(L),p.forEach(L),f.forEach(L),this.h()},h(){$(a,"id","user-stuff"),$(a,"class","svelte-1xrws9x"),$(i,"class","material-icons"),$(o,"id","dock"),$(o,"class","svelte-1xrws9x"),$(t,"id","statusbar"),$(t,"class","svelte-1xrws9x")},m(e,g){I(e,t,g),E(t,a),T.m(a,null),E(t,s),E(t,r),F(n,r,null),E(t,l),E(t,o),E(o,i),E(i,c),E(o,u),E(o,h),E(h,d),f=!0},p(e,[t]){D===(D=g(e))&&T?T.p(e,t):(T.d(1),T=D(e),T&&(T.c(),T.m(a,null)))},i(e){f||(M(n.$$.fragment,e),f=!0)},o(e){C(n.$$.fragment,e),f=!1},d(e){e&&L(t),T.d(),X(n)}}}function dt(e,t,a){let s="",r=!1;return be.subscribe((e=>{var t;a(0,s=null===(t=e.userData)||void 0===t?void 0:t.email),a(1,r=e.loggedIn)})),we().then((e=>a(1,r=e))),[s,r]}class ft extends d{constructor(e){super(),f(this,e,dt,ht,g,{})}}const{window:gt}=G;function mt(e,t,a){const s=e.slice();return s[38]=t[a],s[39]=t,s[40]=a,s}function pt(e){let t,a,s;return{c(){t=m("div"),a=m("h1"),s=p("Loading..."),this.h()},l(e){t=y(e,"DIV",{});var r=b(t);a=y(r,"H1",{class:!0});var n=b(a);s=w(n,"Loading..."),n.forEach(L),r.forEach(L),this.h()},h(){$(a,"class","svelte-rhl0rc")},m(e,r){I(e,t,r),E(t,a),E(a,s)},p:N,i:N,o:N,d(e){e&&L(t)}}}function vt(e){let t,a,s=e[0],r=[];for(let l=0;l<s.length;l+=1)r[l]=wt(mt(e,s,l));const n=e=>C(r[e],1,1,(()=>{r[e]=null}));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=z()},l(e){for(let t=0;t<r.length;t+=1)r[t].l(e);t=z()},m(e,s){for(let t=0;t<r.length;t+=1)r[t].m(e,s);I(e,t,s),a=!0},p(e,a){if(25&a[0]){let l;for(s=e[0],l=0;l<s.length;l+=1){const n=mt(e,s,l);r[l]?(r[l].p(n,a),M(r[l],1)):(r[l]=wt(n),r[l].c(),M(r[l],1),r[l].m(t.parentNode,t))}for(B(),l=s.length;l<r.length;l+=1)n(l);Y()}},i(e){if(!a){for(let e=0;e<s.length;e+=1)M(r[e]);a=!0}},o(e){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)C(r[t]);a=!1},d(e){ee(r,e),e&&L(t)}}}function yt(e){var t,a;let s,r,n,l,o,i,c;function u(t){e[19](t)}let h={addedClass:`${1==(null==(t=e[38])?void 0:t.top)?"zindexMax":""} ${1==(null==(a=e[38])?void 0:a.active)?"active":""}`,frame:e[38]};function d(...t){return e[21](e[38],e[39],e[40],...t)}return void 0!==e[0]&&(h.frameList=e[0]),r=new Ye({props:h}),W.push((()=>_(r,"frameList",u))),r.$on("message",e[20]),{c(){s=m("div"),j(r.$$.fragment),l=v()},l(e){s=y(e,"DIV",{});var t=b(s);J(r.$$.fragment,t),l=x(t),t.forEach(L)},m(e,t){I(e,s,t),F(r,s,null),E(s,l),o=!0,i||(c=T(s,"pointerdown",d),i=!0)},p(t,a){var s,l;e=t;const o={};1&a[0]&&(o.addedClass=`${1==(null==(s=e[38])?void 0:s.top)?"zindexMax":""} ${1==(null==(l=e[38])?void 0:l.active)?"active":""}`),1&a[0]&&(o.frame=e[38]),!n&&1&a[0]&&(n=!0,o.frameList=e[0],K((()=>n=!1))),r.$set(o)},i(e){o||(M(r.$$.fragment,e),o=!0)},o(e){C(r.$$.fragment,e),o=!1},d(e){e&&L(s),X(r),i=!1,c()}}}function bt(e){let t,a=(e[0]=Ue(e[0]))+"";return{c(){t=p(a)},l(e){t=w(e,a)},m(e,a){I(e,t,a)},p(e,s){1&s[0]&&a!==(a=(e[0]=Ue(e[0]))+"")&&H(t,a)},i:N,o:N,d(e){e&&L(t)}}}function wt(e){let t,a,s,r;const n=[bt,yt],l=[];function o(e,t){return null==e[38]?0:1}return t=o(e),a=l[t]=n[t](e),{c(){a.c(),s=z()},l(e){a.l(e),s=z()},m(e,a){l[t].m(e,a),I(e,s,a),r=!0},p(e,r){let i=t;t=o(e),t===i?l[t].p(e,r):(B(),C(l[i],1,1,(()=>{l[i]=null})),Y(),a=l[t],a?a.p(e,r):(a=l[t]=n[t](e),a.c()),M(a,1),a.m(s.parentNode,s))},i(e){r||(M(a),r=!0)},o(e){C(a),r=!1},d(e){l[t].d(e),e&&L(s)}}}function Lt(e){let t,a,s,r,n,l,o,i,c,u,h,d,f,g,p;function w(t){e[17](t)}function D(t){e[18](t)}let z={};void 0!==e[0]&&(z.frameList=e[0]),void 0!==e[7]&&(z.userData=e[7]),a=new Je({props:z}),W.push((()=>_(a,"frameList",w))),W.push((()=>_(a,"userData",D))),l=new nt({});const N=[vt,pt],P=[];function q(e,t){var a;return(null==(a=e[0])?void 0:a.length)>0?0:e[8]?1:-1}return~(c=q(e))&&(u=P[c]=N[c](e)),d=new ft({}),{c(){t=m("main"),j(a.$$.fragment),n=v(),j(l.$$.fragment),o=v(),i=m("div"),u&&u.c(),h=v(),j(d.$$.fragment),this.h()},l(e){t=y(e,"MAIN",{class:!0});var s=b(t);J(a.$$.fragment,s),n=x(s),J(l.$$.fragment,s),o=x(s),i=y(s,"DIV",{id:!0,class:!0});var r=b(i);u&&u.l(r),r.forEach(L),h=x(s),J(d.$$.fragment,s),s.forEach(L),this.h()},h(){$(i,"id","dropzone"),$(i,"class","svelte-rhl0rc"),$(t,"class","svelte-rhl0rc")},m(s,r){I(s,t,r),F(a,t,null),E(t,n),F(l,t,null),E(t,o),E(t,i),~c&&P[c].m(i,null),e[22](i),E(t,h),F(d,t,null),f=!0,g||(p=[T(gt,"keydown",e[16]),T(i,"dragover",Q(k(xt))),T(i,"drop",Q(k(e[23]))),T(i,"paste",e[24]),T(i,"touchstart",e[25]),T(i,"touchmove",e[26]),T(i,"pointerdown",e[27]),T(i,"pointermove",e[28]),T(i,"pointerup",e[29])],g=!0)},p(e,t){const n={};!s&&1&t[0]&&(s=!0,n.frameList=e[0],K((()=>s=!1))),!r&&128&t[0]&&(r=!0,n.userData=e[7],K((()=>r=!1))),a.$set(n);let l=c;c=q(e),c===l?~c&&P[c].p(e,t):(u&&(B(),C(P[l],1,1,(()=>{P[l]=null})),Y()),~c?(u=P[c],u?u.p(e,t):(u=P[c]=N[c](e),u.c()),M(u,1),u.m(i,null)):u=null)},i(e){f||(M(a.$$.fragment,e),M(l.$$.fragment,e),M(u),M(d.$$.fragment,e),f=!0)},o(e){C(a.$$.fragment,e),C(l.$$.fragment,e),C(u),C(d.$$.fragment,e),f=!1},d(s){s&&L(t),X(a),X(l),~c&&P[c].d(),e[22](null),X(d),g=!1,S(p)}}}const xt=e=>!1;function $t(e,t,a){var s=this&&this.__awaiter||function(e,t,a,s){return new(a||(a=Promise))((function(r,n){function l(e){try{i(s.next(e))}catch(t){n(t)}}function o(e){try{i(s.throw(e))}catch(t){n(t)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}i((s=s.apply(e,t||[])).next())}))};let r,n,l,o=[],i={x:0,y:0},c=null,u="",h=!1,d=null,f=!0;Z((()=>s(void 0,void 0,void 0,(function*(){be.subscribe((e=>s(void 0,void 0,void 0,(function*(){if(a(6,h=e.loggedIn),a(7,d=e.userData),h){console.log("did fetch");const{fetchedFrameList:t,error:a}=yield async function(e){const{data:t,error:a}=await te.storage.from("images").download(`${e.id}/frameData.txt`);if(a)return{fetchedFrameList:null,error:a};{const e=await t.text();try{return 0==e.length?(console.log(JSON.parse(e)),{fetchedFrameList:null,error:null}):{fetchedFrameList:JSON.parse(e),error:null}}catch(s){return{fetchedFrameList:null,error:s}}}}(e.userData);a?console.log(a):0!=t.length&&fe(t)}})))),he.subscribe((e=>s(void 0,void 0,void 0,(function*(){e?(a(0,r=e.framesSnapshot),a(0,r=r.map((e=>(e=Oe(e),Object.assign(Object.assign({},e),{style:ke(e)}))))),console.log(r),h&&(yield se(ve,r))):a(0,r=[])})))),a(6,h=yield we()),a(8,f=!1),a(5,l=window.localStorage),0==h&&(a(0,r=oe(l,"frameList",r)),console.log(r),a(1,n=r?ze(r):[])),(0==h&&null===r||void 0===r||0==(null==r?void 0:r.length))&&(a(0,r=new Array),Te({userData:d,url:"https://c.pxhere.com/images/8c/33/1bb3e98042854d9eee207eb9facc-1622223.jpg!d",frameList:r}).then((e=>{e.x=50,e.y=100,e.style=ke(e),e=Oe(e),r.push(e),a(0,r=Re(e.id,r)),fe(r)}))),fe(r),o=[{currentTrans:"",currentState:ge(o,0,r),framesSnapshot:r}]}))));const g=(e,t)=>s(void 0,void 0,void 0,(function*(){if(console.log("dropped"),e.preventDefault(),e.dataTransfer.items){let t=e.dataTransfer.items[0].getAsFile();if(t&&t.type.includes("image")){let e=URL.createObjectURL(t),s=yield Te({url:e,userData:d,frameList:r});s.x=50,s.y=100,s.style=ke(s),s=Oe(s),a(0,r=[...r,s]),fe(r)}}if(!e.dataTransfer.getData("frame id")){let t=e.dataTransfer.getData("text"),s=yield Te({url:t,userData:d,frameList:r});s.x=e.clientX,s.y=e.clientY,s.style=`position:fixed; left:${s.x}px; top:${s.y}px;`;let n=r;t&&(n=[...n,s]),n=Re(s.id,n),a(0,r=n),fe(r)}"move"==e.dataTransfer.dropEffect&&(console.log("moved"),e.dataTransfer.getData("frame id"),fe(r))}));let m,p=!1,v=!1,y=1;const b=()=>{a(9,p=!0)},w=()=>{a(9,p=!1),a(3,c=null)};P();return[r,n,i,c,u,l,h,d,f,p,v,m,y,g,b,w,e=>{0==h&&a(7,d=null),Pe({userData:d,event:e,frameList:r})},function(e){r=e,a(0,r)},function(e){d=e,a(7,d)},function(e){r=e,a(0,r)},e=>{var t,s;let r=e;a(3,c=null==(t=null==r?void 0:r.detail)?void 0:t.frame.id),a(4,u=null==(s=null==r?void 0:r.detail)?void 0:s.edge)},(e,t,s,n)=>{("touch"==n.pointerType&&n.isPrimary||"mouse"==n.pointerType)&&(a(0,t[s]=Oe(e),r),a(0,r=Re(e.id,r)))},function(e){W[e?"unshift":"push"]((()=>{m=e,a(11,m)}))},e=>g(e),async e=>{try{await He({userData:d,frameList:r,event:e,appStorage:l,loggedIn:h})}catch(t){console.log(t)}},e=>{if(e.preventDefault(),e.targetTouches.length>1)try{let t=e.targetTouches[0],s=e.targetTouches[1],l=Math.abs(t.clientX-s.clientX),o=Math.abs(t.clientY-s.clientY);a(12,y=Math.sqrt(l**2+o**2)),a(1,n=ze(r))}catch(t){console.log(t)}},e=>{var t;2==e.targetTouches.length&&a(0,r=function(e,t,a){t.preventDefault();const s={transfomScale:1,center:[200,200]},r=t.targetTouches[0],n=t.targetTouches[1],l=Math.abs(r.clientX-n.clientX),o=Math.abs(r.clientY-n.clientY);s.transfomScale=Math.sqrt(l**2+o**2);const i=s.transfomScale/a;return[...e].map((e=>(e.width*=i,e.height*=i,e.x*=i,e.y*=i,(e=Oe(e)).style=ke(e),e)))}(ze(n),e,y)),v&&1==(null==(t=null==e?void 0:e.changedTouches)?void 0:t.length)&&a(0,r=r.map((t=>t=Ae(e,t,t.offset))))},e=>{"dropzone"==e.target.id?(("touch"==e.pointerType&&e.isPrimary||"mouse"==e.pointerType)&&a(0,r=Se(r)),"touch"==e.pointerType&&(e.isPrimary?a(10,v=!0):a(10,v=!1)),"mouse"==e.pointerType&&a(10,v=!0),a(0,r=r.map((t=>(t.offset=[e.clientX-t.x,e.clientY-t.y],t))))):b()},e=>{1==p&&r[c]&&a(0,r[c]=function(e,t,a){let s=a[t];const r=s.x,n=(s.y,{x:0,y:0});switch(e.pointerType){case"touch":console.log(e),s.width=e.clientX-r,s.height=s.width/s.aspect;break;default:case"mouse":n.x=e.movementX,n.y=e.movementY,s.width+=n.x,s.height+=n.x/s.aspect,s.bottomRightHandle.x+=n.x,s.bottomRightHandle.y+=s.height}return s=Oe(s),s.style=ke(s),s}(e,c,r),r),v&&"mouse"===(null==e?void 0:e.pointerType)&&a(0,r=r.map((t=>t=Ae(e,t,t.offset))))},e=>{w(),a(10,v=!1),fe(r),ie({userData:d,frameList:r})}]}class Dt extends d{constructor(e){super(),f(this,e,$t,Lt,g,{},null,[-1,-1])}}export{Dt as default};
